{% extends "profile/base.html" %}
{%- block head -%}
  <link rel="stylesheet" href="{{ url_for('static', filename='markdown/css/bootstrap-markdown.min.css') }}">
{%- endblock -%}
{% block content %}
  <div class="box box-primary">
    <div class="box-header with-border">
      <h3 class="box-title"><span>发布文章</span></h3>
    </div>
    <form id="postForm" method="post" class="form-horizontal">
      <div class="box-body">
        {{ form.hidden_tag() }}
        {{ form.sid(style="display:none") }}
        <div class="form-group">
          <label class="control-label col-sm-2" for="inputShortcut">标题</label>
          <div class="col-sm-9">
            {{ form.title(class="form-control required",id="inputTitle", placeholder="在此输入标题") }}
          </div>
        </div>
        <div class="form-group">
          <label class="control-label col-sm-2" for="inputShortcut">摘要</label>
          <div class="col-sm-9">
            {{ form.shortcut(class='required',id="inputShortcut", rows="6", style="resize:none;padding:10px;" , placeholder="摘要") }}
          </div>
        </div>
        <div class="form-group">
          <label class="control-label col-sm-2" for="inputContent">正文</label>
          <div class="col-sm-9">
            {{ form.content(class='required', id="inputContent" , rows="25", style="resize:none;padding:10px;" , placeholder="正文") }}
          </div>
        </div>
        <div class="form-group">
          <label class="control-label col-sm-2" for="inputTag">标签</label>
          <div class="col-sm-9">
            {{ form.tags(class='form-control required', id="inputTag" , placeholder="标签") }}
          </div>
        </div>
        <div class="form-group">
          <label class="control-label col-sm-2" for="inputTag">相关题目</label>
          <div class="col-sm-2">
            {{ form.problem_oj_name(class="form-control") }}
          </div>
          <div class="col-sm-4">
            {{ form.problem_pid(class="form-control", placeholder="题目ID（可以留空）") }}
          </div>
        </div>
        <div class="alert alert-error col-sm-offset-2 col-sm-9" id="post-info" style="display: none;">
          <button type="button" class="close">&times;</button>
          <span id="post-info-text"></span>
        </div>
      </div>
      <div class="box-footer text-center">
        {{ form.submit(class='btn btn-primary btn-flat', value='提交文章') }}
      </div>
    </form>
  </div>
{% endblock %}
{%- block script -%}
<script src="{{ url_for('static', filename='markdown/js/markdown.min.js') }}"></script>
<script src="{{ url_for('static', filename='markdown/js/bootstrap-markdown.min.js') }}"></script>
  <script>
    $(document).ready(function () {
      $("button.close").click(function () {
        $(".alert").slideUp();
        return false;
      });
      $('#inputShortcut').markdown({iconlibrary: 'fa'});
      $('#inputContent').markdown({iconlibrary: 'fa'});
      $('.md-editor').on("click", ".btn[title='Preview']", function () {
        MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
      });
      $('#postForm').submit(function () {
        var title = $('#inputTitle');
        var shortcut = $('#inputShortcut');
        var content = $('#inputContent');
        if (requiredCheck(title, '标题')) {
          $.post("{{ url_for('ajax.solution_manager') }}", $('#postForm').serialize()).success(
              function (data) { $("#post-info-text").html(data); $("#post-info").hide().fadeIn(200); }
          );
        }
        return false;
      });
    });
  </script>
{%- endblock -%}