{% extends "admin/base.html" %}
{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='AdminLTE2/plugins/iCheck/square/blue.css') }}"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap-fileinput/css/fileinput.min.css') }}"/>
{% endblock %}
{% block content %}
<div class="box box-primary">
  <div class="box-header with-border">
      <h3 class="box-title"><i class="fa fa-upload"></i> <span>上传资源</span></h3>
  </div>
  <form id="postForm" method="post" class="form-horizontal">
    <div class="box-body">
      {{ form.hidden_tag() }}
      <div class="col-sm-8 col-md-9">
        <div class="form-group">
          <label class="control-label col-sm-2" for="inputName">name</label>
          <div class="col-sm-9">
            {{ form.name(class="form-control required",id="inputName", placeholder="name") }}
          </div>
        </div>
        <div class="form-group">
          <label class="control-label col-sm-2" for="inputShortcut">简介</label>
          <div class="col-sm-9">
            {{ form.description(class='form-control required',id="inputdescription", rows="6", style="resize:none;" , placeholder="简介") }}
          </div>
        </div>
          <div class="form-group">
          <label class="control-label col-sm-2" for="inputShortcut">选择文件</label>
          <div class="col-sm-9">
            {{ form.upload(id="inputFile") }}
          </div>
        </div>
        <div class="form-group">
          <label class="control-label col-sm-2"><span class="required-star">* </span>权限</label>
          <div class="col-sm-9">
            {%- for sub in form.level %}
              <label class="radio-inline">
                {{ sub }}
                {{ sub.label(style='margin-left:10px;') }}
              </label>
            {%- endfor %}
          </div>
        </div>
        <div class="form-group">
          <label class="control-label col-sm-2"><span class="required-star">* </span>用途</label>
          <div class="col-sm-9">
            {%- for sub in form.usage %}
              <label class="radio-inline">
                {{ sub }}
                {{ sub.label(style='margin-left:10px;') }}
              </label>
            {%- endfor %}
          </div>
        </div>
        <div class="form-group">
          <div class="control-label col-sm-2"></div>
          <div class="col-sm-9">
            {{ form.submit(class='btn btn-primary', value='提交') }}
          </div>
        </div>
        <div class="alert alert-info col-sm-offset-2 col-sm-9" id="post-info" style="display: none;">
          <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
          <span id="post-info-text"></span>
        </div>
      </div>
    </div>
  </form>
</div>


{% endblock %}
{%- block script -%}
<script src="{{ url_for('static', filename='AdminLTE2/plugins/iCheck/icheck.min.js') }}"></script>
<script src="{{ url_for('static', filename='bootstrap-fileinput/js/fileinput.min.js') }}"></script>
<script src="{{ url_for('static', filename='bootstrap-fileinput/js/fileinput_locale_zh.js') }}"></script>
<script>

function make_iCheck() {
  $('input[type="radio"], input[type="checkbox"]').iCheck({
    checkboxClass: 'icheckbox_square-blue',
    radioClass: 'iradio_square-blue',
     increaseArea: '20%' // optional
  });
}

$(document).ready(function () {
  make_iCheck();
  var previewer = $("#preview");
  if(typeof FileReader == 'undefined') {
    previewer.InnerHTML="<p>你的浏览器不支持FileReader接口！</p>";
    this.setAttribute("disabled","disabled");
  }
  $("button.close").click(function () {
    $(".alert").slideUp();
    return false;
  });
  previewer.on('click', function() {
     $("#inputFile").click();
  });
  $("#inputFile").fileinput({'showUpload':false});
  $('#postForm').submit(function() {
      var data = new FormData($('#postForm')[0]);
      var file = $("#inputFile")[0];
      data.append(file.name,file.files[0]);
      $.ajax({
        url: "{{ url_for('ajax.upload') }}",
        type: "POST",
        data: data,
        processData: false,  // 告诉jQuery不要去处理发送的数据
        contentType: false,   // 告诉jQuery不要去设置Content-Type请求头
        success:function (msg) {
          $("#post-info-text").html(msg);
          $("#post-info").hide().fadeIn(200);
        }
      });
      return false;
  });
});
</script>
{%- endblock -%}